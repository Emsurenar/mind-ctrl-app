<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impuls & Fokus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { background-color: #000000; color: #6ca1e1; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .input-field { @apply w-full bg-slate-700 border border-slate-600 rounded-lg py-4 px-8 mb-6 text-lg text-white focus:outline-none focus:border-blue-500 transition-all; }
        .btn-primary { @apply w-full bg-blue-900 hover:bg-blue-800 text-white font-bold py-3 px-4 rounded-2xl transition-colors active:scale-95; }
        .btn-secondary { @apply w-full bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 px-4 rounded transition-colors active:scale-95; }
        .card { @apply bg-slate-900 border border-slate-800 rounded-lg p-4 shadow-lg mb-4; }
        
        @keyframes pulse-red {
            0%, 100% { background-color: #7f1d1d; }
            50% { background-color: #991b1b; }
        }
        .animate-alarm { animation: pulse-red 1s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- INLINE ICONS ---
        const IconTimer = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const IconZap = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>;
        const IconList = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>;
        const IconBell = () => <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>;
        const IconTrash = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;

        // --- AUDIO HELPER (Syntetiskt ljud, inga filer beh칬vs) ---
        const playBeep = () => {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                const ctx = new AudioContext();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.type = 'square';
                osc.frequency.setValueAtTime(440, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
                osc.start();
                osc.stop(ctx.currentTime + 0.5);
            } catch (e) { console.error("Audio error", e); }
        };

        const NavButton = ({ active, icon, label, onClick }) => (
            <button 
                onClick={onClick}
                className={`flex flex-col items-center justify-center p-2 flex-1 transition-colors ${active ? 'text-blue-400' : 'text-slate-500 hover:text-slate-300'}`}
            >
                {icon}
                <span className="text-xs mt-1">{label}</span>
            </button>
        );

        // 1. Aktivitetstimer (Uppdaterad med Nedr칛kning & Alarm)
        const ActivityTimer = () => {
            const [state, setState] = useState('setup'); // setup, running, alarm, review
            const [data, setData] = useState({ goal: '', challenges: '', motivation: 5, durationMinutes: 25 });
            const [remaining, setRemaining] = useState(0);
            const [initialDuration, setInitialDuration] = useState(0); // Sparar totaltiden f칬r loggen
            const [review, setReview] = useState({ success: true, satisfaction: 5 });
            const [sessionBehaviors, setSessionBehaviors] = useState([]);
            
            // Timer logic
            useEffect(() => {
                let interval;
                if (state === 'running') {
                    interval = setInterval(() => {
                        setRemaining(prev => {
                            if (prev <= 1) {
                                clearInterval(interval);
                                setState('alarm');
                                return 0;
                            }
                            return prev - 1;
                        });
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [state]);

            // Alarm Sound Loop
            useEffect(() => {
                let soundInterval;
                if (state === 'alarm') {
                    playBeep(); // Spela direkt
                    soundInterval = setInterval(playBeep, 1500); // Repetera var 1.5s
                }
                return () => clearInterval(soundInterval);
            }, [state]);

            const startSession = () => {
                const totalSeconds = parseInt(data.durationMinutes) * 60;
                setRemaining(totalSeconds);
                setInitialDuration(totalSeconds);
                setSessionBehaviors([]);
                setState('running');
            };

            const stopAlarm = () => {
                setState('review');
            };

            const cancelSession = () => {
                if(confirm("Vill du avbryta passet?")) {
                    setSessionBehaviors([]);
                    setState('setup');
                }
            }

            const saveSession = () => {
                const sessionLog = {
                    type: 'activity',
                    timestamp: new Date().toISOString(),
                    durationSeconds: initialDuration,
                    completed: true,
                    ...data,
                    ...review,
                    behaviors: sessionBehaviors
                };
                saveToLog(sessionLog);
                setState('setup');
                setData({ goal: '', challenges: '', motivation: 5, durationMinutes: 25 });
                setSessionBehaviors([]);
                alert("Pass sparat!");
            };

            const formatTime = (s) => {
                const min = Math.floor(s / 60);
                const sec = s % 60;
                return `${min}:${sec < 10 ? '0' : ''}${sec}`;
            };

            // --- Vyer ---

            const isInvalid = !data.goal;

            if (state === 'setup') return (
                <div className="p-4 space-y-8 text-center h-full flex flex-col">
                    <h2 className="text-4xl font-bold">Starta fokuspass</h2>
                    <div>
                        <label className="block text-xl text-slate-400 mb-2 font-bold">Tidsl칛ngd</label>
                        <div className="flex gap-2">
                            {[15, 25, 45, 60].map(m => (
                                <button key={m} onClick={() => setData({...data, durationMinutes: m})} className={`flex-1 py-2 rounded border ${data.durationMinutes === m ? 'bg-blue-600 border-blue-500' : 'bg-slate-800 border-slate-700'}`}>{m}</button>
                            ))}
                        </div>
                        <input type="number" className="input-field mt-4 text-center text-lg" value={data.durationMinutes} onChange={e => setData({...data, durationMinutes: e.target.value})} />
                    </div>
                    <div>
                        <label className="block text-xl text-slate-400 mb-2 font-bold">Vad 칛r m친let?</label>
                        <input className="input-field" value={data.goal} onChange={e => setData({...data, goal: e.target.value})} />
                    </div>
                    <div>
                        <label className="block text-xl text-slate-400 mb-2 font-bold">Vilka utmaningar f칬rv칛ntas uppst친?</label>
                        <input className="input-field" value={data.challenges} onChange={e => setData({...data, challenges: e.target.value})} />
                    </div>
                    <div>
                        <label className="block text-xl text-slate-400 mb-2 font-bold">Motivation (1-10)</label>
                        <div className="flex items-center gap-4">
                            <input type="range" min="1" max="10" value={data.motivation} onChange={e => setData({...data, motivation: parseInt(e.target.value)})} className="w-full accent-blue-500" />
                            <span className="font-bold w-6">{data.motivation}</span>
                        </div>
                    </div>
                    <div className="flex-1"></div>
                    <button disabled={isInvalid} className={`w-4/5 mx-auto block font-bold text-2xl py-5 rounded-2xl transition-all duration-1000 shadow-xl ${isInvalid ? 'bg-slate-800 text-slate-600 cursor-not-allowed' : 'bg-orange-500 hover:bg-orange-600 text-white hover:scale-110 active:scale-95'}`} onClick={startSession}>Starta timer</button>
                </div>
            );

            if (state === 'running') {
                const progress = ((initialDuration - remaining) / initialDuration) * 100;
                const behaviors = ["Prokastinering", "Tappat fokus", "Impulsivitet", "Stress", "Bra flow"];
                return (
                    <div className="flex flex-col h-full p-4 relative pt-6">
                        {/* Progress bar background */}
                        <div className="absolute top-0 left-0 h-2 bg-slate-800 w-full">
                            <div className="h-full bg-green-500 transition-all duration-1000" style={{width: `${progress}%`}}></div>
                        </div>

                        <div className="flex-1 flex flex-col items-center justify-center">
                            <div className="text-7xl font-mono font-bold text-green-400 mb-8 tracking-tighter">{formatTime(remaining)}</div>
                            <div className="text-center mb-8 space-y-2 max-w-xs">
                                <p className={`text-white font-bold ${data.challenges ? 'text-lg' : 'text-2xl'}`}>{data.goal}</p>
                                {data.challenges && <p className="text-slate-400 text-sm">Utmaning: {data.challenges}</p>}
                            </div>
                        </div>
                        
                        <div className="grid grid-cols-2 gap-3 mb-6">
                            {behaviors.map(b => (
                                <button key={b} onClick={() => setSessionBehaviors([...sessionBehaviors, { behavior: b, timestamp: new Date().toISOString() }])} className="btn-secondary h-16 text-sm shadow-md border-b-4 border-slate-900 active:border-b-0 active:translate-y-1">{b}</button>
                            ))}
                        </div>

                        <button className="text-slate-500 hover:text-white underline text-sm mt-4 text-center" onClick={cancelSession}>Avbryt pass</button>
                    </div>
                );
            }

            if (state === 'alarm') return (
                <div className="flex flex-col items-center justify-center h-full p-4 animate-alarm bg-red-900">
                    <IconBell />
                    <h1 className="text-4xl font-bold text-white mt-4 mb-8">Tiden 칛r ute!</h1>
                    <p className="text-white/80 mb-8 text-center">{data.goal}</p>
                    <button className="w-full bg-transparent text-white text-xl font-bold py-6 hover:text-slate-200 transition-colors active:scale-95" onClick={stopAlarm}>
                        St칛ng av och utv칛rdera
                    </button>
                </div>
            );

            if (state === 'review') return (
                <div className="p-4 space-y-4 text-center">
                    <h2 className="text-xl font-bold">Bra jobbat!</h2>
                    <p className="text-slate-400">Du fokuserade i {data.durationMinutes} minuter.</p>
                    <div className="space-y-2">
                        <p>Uppn친dde du m친let?</p>
                        <div className="flex gap-2">
                            <button onClick={() => setReview({...review, success: true})} className={`flex-1 p-3 rounded border ${review.success ? 'bg-green-900/30 border-green-500 text-green-400' : 'border-slate-700'}`}>Ja</button>
                            <button onClick={() => setReview({...review, success: false})} className={`flex-1 p-3 rounded border ${!review.success ? 'bg-red-900/30 border-red-500 text-red-400' : 'border-slate-700'}`}>Nej</button>
                        </div>
                    </div>
                    <div>
                        <label className="block text-sm text-slate-400 mb-1">N칬jdhet (1-10)</label>
                        <div className="flex items-center gap-4">
                            <input type="range" min="1" max="10" value={review.satisfaction} onChange={e => setReview({...review, satisfaction: parseInt(e.target.value)})} className="w-full accent-blue-500" />
                            <span className="font-bold w-6">{review.satisfaction}</span>
                        </div>
                    </div>
                    <button className="btn-primary" onClick={saveSession}>Spara till Logg</button>
                    <button className="text-slate-400 hover:text-white text-sm mt-4 underline block w-full" onClick={() => {
                        setState('setup');
                        setData({ goal: '', challenges: '', motivation: 5, durationMinutes: 25 });
                        setSessionBehaviors([]);
                    }}>Spara inte</button>
                </div>
            );
        };

        // 2. Impulskontroll (Of칬r칛ndrad logik, bara inlistad f칬r kompletthet)
        const ImpulseControl = () => {
            const [impulses, setImpulses] = useState([]);
            const [newImpulse, setNewImpulse] = useState({ desc: '', estTime: '' });
            const [now, setNow] = useState(Date.now());
            const [stats, setStats] = useState({ done: 0, forgotten: 0 });

            useEffect(() => {
                const interval = setInterval(() => setNow(Date.now()), 1000);
                const saved = localStorage.getItem('impulses');
                if(saved) setImpulses(JSON.parse(saved));
                updateStats();
                return () => clearInterval(interval);
            }, []);

            useEffect(() => {
                localStorage.setItem('impulses', JSON.stringify(impulses));
            }, [impulses]);

            const updateStats = () => {
                const logs = JSON.parse(localStorage.getItem('logs') || '[]');
                const now = Date.now();
                const oneDay = 24 * 60 * 60 * 1000;
                const recent = logs.filter(l => (now - new Date(l.timestamp).getTime()) < oneDay);
                setStats({
                    done: recent.filter(l => l.type === 'impulse_done').length,
                    forgotten: recent.filter(l => l.type === 'impulse_forgotten').length
                });
            };

            const addImpulse = () => {
                if(!newImpulse.desc || !newImpulse.estTime) return;
                const estMinutes = parseInt(newImpulse.estTime);
                let waitMinutes = 0;
                if (estMinutes < 20) waitMinutes = 30; 
                else waitMinutes = estMinutes * 3;

                const unlockTime = Date.now() + (waitMinutes * 60 * 1000);
                setImpulses([{id: Date.now(), desc: newImpulse.desc, estTime: estMinutes, unlockTime}, ...impulses]);
                setNewImpulse({ desc: '', estTime: '' });
            };

            const completeImpulse = (id, action) => {
                const updated = impulses.filter(i => i.id !== id);
                setImpulses(updated);
                saveToLog({ type: action === 'done' ? 'impulse_done' : 'impulse_forgotten', timestamp: new Date().toISOString(), impulseId: id });
                updateStats();
            };

            const formatCountdown = (unlockTime) => {
                const diff = unlockTime - now;
                if (diff <= 0) return "REDO";
                const h = Math.floor(diff / (1000 * 60 * 60));
                const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((diff % (1000 * 60)) / 1000);
                return `${h}h ${m}m ${s}s`;
            };

            const isInvalid = !newImpulse.desc || !newImpulse.estTime;

            return (
                <div className="p-4 h-full overflow-y-auto pb-20 text-center">
                    <div className="sticky top-0 z-10 bg-slate-950 pb-4">
                        <h2 className="text-4xl font-bold mb-6">Registrera Impuls</h2>
                        <input className="input-field text-center" placeholder="Vad vill du g칬ra?" value={newImpulse.desc} onChange={e => setNewImpulse({...newImpulse, desc: e.target.value})} />
                        <input type="number" className="input-field text-center mt-[3px]" placeholder="Tid (min)?" value={newImpulse.estTime} onChange={e => setNewImpulse({...newImpulse, estTime: e.target.value})} />
                        <button disabled={isInvalid} className={`w-2/5 mx-auto block font-bold text-lg py-2 mt-[10px] rounded-2xl transition-all duration-300 shadow-xl ${isInvalid ? 'bg-slate-800 text-slate-600 cursor-not-allowed' : 'bg-orange-500 hover:bg-orange-600 text-white hover:scale-110 active:scale-95'}`} onClick={addImpulse}>L친s in</button>
                    </div>
                    <div className="space-y-4 mt-6 text-left">
                        {impulses.length === 0 && <p className="text-center text-slate-500 mt-10 text-xl">Inga aktiva impulser.</p>}
                        {impulses.map(imp => {
                            const isReady = imp.unlockTime <= now;
                            return (
                                <div key={imp.id} className={`card border-l-4 ${isReady ? 'border-l-green-500' : 'border-l-red-500'}`}>
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <h3 className="font-bold text-2xl">{imp.desc}</h3>
                                            <p className="text-slate-400 text-base">Estimerad tid: {imp.estTime} min</p>
                                        </div>
                                        {isReady ? (
                                            <div className="flex flex-col gap-2">
                                                <button onClick={() => completeImpulse(imp.id, 'done')} className="bg-green-600 px-4 py-2 rounded text-base font-bold hover:bg-green-500">G칬r</button>
                                                <button onClick={() => completeImpulse(imp.id, 'forgotten')} className="bg-slate-600 px-4 py-2 rounded text-base font-bold hover:bg-slate-500">Gl칬m</button>
                                            </div>
                                        ) : <span className="font-mono text-yellow-500 font-bold text-xl">{formatCountdown(imp.unlockTime)}</span>}
                                    </div>
                                </div>
                            )
                        })}
                    </div>
                    <div className="mt-8 pt-4 border-t border-slate-800 text-slate-400 text-base flex justify-around">
                        <div>
                            <span className="block text-4xl font-bold text-green-400">{stats.done}</span>
                            <span className="text-sm uppercase font-bold">Gjorda (24h)</span>
                        </div>
                        <div>
                            <span className="block text-4xl font-bold text-slate-400">{stats.forgotten}</span>
                            <span className="text-sm uppercase font-bold">Gl칬mda (24h)</span>
                        </div>
                    </div>
                </div>
            );
        };

        // 3. Beteendelogg
        const BehaviorLogger = () => {
            const [logs, setLogs] = useState([]);
            const [selectedLog, setSelectedLog] = useState(null);
            const [timeRange, setTimeRange] = useState('24h');

            useEffect(() => {
                const saved = localStorage.getItem('logs');
                if(saved) setLogs(JSON.parse(saved));
            }, []);

            const deleteLog = (timestamp) => {
                const updated = logs.filter(l => l.timestamp !== timestamp);
                setLogs(updated);
                localStorage.setItem('logs', JSON.stringify(updated));
            };

            // Statistik-ber칛kning
            const now = new Date();
            const timeWindow = timeRange === '24h' ? 24 * 60 * 60 * 1000 : 7 * 24 * 60 * 60 * 1000;
            const recentActivity = logs.filter(l => l.type === 'activity' && (now - new Date(l.timestamp).getTime()) < timeWindow);
            const totalMinutes = Math.round(recentActivity.reduce((acc, curr) => acc + (curr.durationSeconds / 60), 0));
            
            const hoursDistribution = new Array(24).fill(0);
            recentActivity.forEach(l => {
                const h = new Date(l.timestamp).getHours();
                hoursDistribution[h] += (l.durationSeconds / 60);
            });
            const maxVal = Math.max(...hoursDistribution, 1);

            // Cirkeldiagram-data
            const behaviorCounts = {};
            recentActivity.forEach(l => {
                if (l.behaviors) {
                    l.behaviors.forEach(b => {
                        behaviorCounts[b.behavior] = (behaviorCounts[b.behavior] || 0) + 1;
                    });
                }
            });
            const totalBehaviors = Object.values(behaviorCounts).reduce((a, b) => a + b, 0);
            let currentAngle = 0;
            const colors = ['#60a5fa', '#34d399', '#f87171', '#fbbf24', '#a78bfa', '#e879f9'];
            const pieSegments = Object.entries(behaviorCounts).sort((a,b) => b[1] - a[1]).map(([name, count], index) => {
                const angle = (count / totalBehaviors) * 360;
                const color = colors[index % colors.length];
                const style = `${color} ${currentAngle}deg ${currentAngle + angle}deg`;
                currentAngle += angle;
                return { name, percentage: Math.round((count/totalBehaviors)*100), color, style };
            });
            const pieGradient = `conic-gradient(${pieSegments.map(s => s.style).join(', ')})`;

            return (
                <div className="p-4 h-full flex flex-col text-center">
                    <div className="flex justify-center gap-2 mb-4 bg-slate-900 p-1 rounded-lg inline-flex mx-auto border border-slate-800">
                        <button onClick={() => setTimeRange('24h')} className={`px-4 py-1 rounded text-xs font-bold transition-colors ${timeRange === '24h' ? 'bg-blue-600 text-white' : 'text-slate-400 hover:text-white'}`}>24h</button>
                        <button onClick={() => setTimeRange('7d')} className={`px-4 py-1 rounded text-xs font-bold transition-colors ${timeRange === '7d' ? 'bg-blue-600 text-white' : 'text-slate-400 hover:text-white'}`}>7 dagar</button>
                    </div>

                    <div className="bg-slate-900 rounded p-4 border border-slate-800 mb-4">
                        <h3 className="text-slate-400 text-xs uppercase font-bold mb-2 tracking-wider">Total fokustid ({timeRange === '24h' ? '24h' : '7 dagar'})</h3>
                        <div className="text-3xl font-bold text-white mb-4">{totalMinutes} <span className="text-sm text-slate-500 font-normal">min</span></div>
                        
                        <div className="flex items-end justify-between h-16 gap-[2px]">
                            {hoursDistribution.map((mins, i) => (
                                <div key={i} className="flex-1 flex flex-col justify-end group relative h-full">
                                    <div className={`w-full rounded-t-sm ${mins > 0 ? 'bg-blue-500' : 'bg-slate-800'}`} style={{height: `${(mins / maxVal) * 100}%`, minHeight: '2px'}}></div>
                                </div>
                            ))}
                        </div>
                        <div className="flex justify-between text-[10px] text-slate-500 mt-1 px-1"><span>00</span><span>06</span><span>12</span><span>18</span><span>23</span></div>
                    </div>
                    {totalBehaviors > 0 && (
                        <div className="bg-slate-900 rounded p-4 border border-slate-800 mb-4">
                            <h3 className="text-slate-400 text-xs uppercase font-bold mb-4 tracking-wider">Beteenden ({timeRange === '24h' ? '24h' : '7 dagar'})</h3>
                            <div className="flex items-center gap-4">
                                <div className="w-24 h-24 rounded-full flex-shrink-0" style={{ background: pieGradient }}></div>
                                <div className="flex-1 space-y-1 text-left">
                                    {pieSegments.map(s => (
                                        <div key={s.name} className="flex items-center justify-between text-xs">
                                            <div className="flex items-center gap-2"><div className="w-2 h-2 rounded-full" style={{backgroundColor: s.color}}></div><span className="text-slate-300">{s.name}</span></div>
                                            <span className="font-bold text-white">{s.percentage}%</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                    <div className="flex-1 overflow-y-auto bg-slate-900 rounded p-4 border border-slate-800">
                        <h3 className="text-slate-400 text-xs uppercase font-bold mb-3 tracking-wider">Senaste h칛ndelser</h3>
                        <div className="space-y-2">
                            {logs.slice().reverse().filter(l => l.type === 'activity').slice(0, 20).map((l) => (
                                <div key={l.timestamp} onClick={() => setSelectedLog(l)} className="group flex items-center justify-between text-sm border-b border-slate-800 pb-2 min-h-[32px] cursor-pointer hover:bg-slate-800/50 px-2 -mx-2 rounded transition-colors">
                                    <span className={l.type === 'activity' ? 'text-blue-400 font-bold' : 'text-white'}>
                                        {l.type === 'activity' ? `游꿢 ${l.goal} (${Math.round(l.durationSeconds/60)}m)` : l.behavior}
                                    </span>
                                    <div className="flex items-center gap-3">
                                        <span className="text-slate-500">{new Date(l.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                                        <button onClick={(e) => { e.stopPropagation(); deleteLog(l.timestamp); }} className="text-red-400 opacity-0 group-hover:opacity-100 transition-opacity" title="Ta bort">
                                            <IconTrash />
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {selectedLog && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4" onClick={() => setSelectedLog(null)}>
                            <div className="bg-slate-900 border border-slate-700 p-6 rounded-xl max-w-sm w-full shadow-2xl" onClick={e => e.stopPropagation()}>
                                <h3 className="text-xl font-bold mb-4 text-white">Detaljer</h3>
                                {selectedLog.type === 'activity' ? (
                                    <div className="space-y-3 text-left text-sm">
                                        <p><span className="text-slate-400 block text-xs uppercase">Typ</span> Fokuspass</p>
                                        <p><span className="text-slate-400 block text-xs uppercase">Tid</span> {new Date(selectedLog.timestamp).toLocaleString()}</p>
                                        <p><span className="text-slate-400 block text-xs uppercase">L칛ngd</span> {Math.round(selectedLog.durationSeconds / 60)} min</p>
                                        <p><span className="text-slate-400 block text-xs uppercase">M친l</span> {selectedLog.goal}</p>
                                        <p><span className="text-slate-400 block text-xs uppercase">Utmaningar</span> {selectedLog.challenges || '-'}</p>
                                        <p><span className="text-slate-400 block text-xs uppercase">N칬jdhet</span> {selectedLog.satisfaction}/10</p>
                                        <p><span className="text-slate-400 block text-xs uppercase">Lyckades?</span> {selectedLog.success ? 'Ja' : 'Nej'}</p>
                                        {selectedLog.behaviors && selectedLog.behaviors.length > 0 && (
                                            <div className="pt-2 mt-2 border-t border-slate-700">
                                                <p><span className="text-slate-400 block text-xs uppercase mb-1">Beteenden</span></p>
                                                <ul className="list-disc pl-4 space-y-1 text-slate-300">
                                                    {selectedLog.behaviors.map((b, i) => <li key={i}>{b.behavior} <span className="text-slate-500 text-xs">({new Date(b.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})})</span></li>)}
                                                </ul>
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    <div className="space-y-3 text-left text-sm">
                                        <p><span className="text-slate-400 block text-xs uppercase">Typ</span> Beteende</p>
                                        <p><span className="text-slate-400 block text-xs uppercase">H칛ndelse</span> {selectedLog.behavior}</p>
                                        <p><span className="text-slate-400 block text-xs uppercase">Tid</span> {new Date(selectedLog.timestamp).toLocaleString()}</p>
                                    </div>
                                )}
                                <button className="btn-primary mt-6" onClick={() => setSelectedLog(null)}>St칛ng</button>
                            </div>
                        </div>
                    )}

                    <button className="mt-4 text-xs text-slate-500 underline text-center" onClick={() => {
                        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(logs));
                        const downloadAnchorNode = document.createElement('a');
                        downloadAnchorNode.setAttribute("href", dataStr);
                        downloadAnchorNode.setAttribute("download", "mind_data.json");
                        document.body.appendChild(downloadAnchorNode);
                        downloadAnchorNode.click();
                        downloadAnchorNode.remove();
                    }}>Exportera data (JSON)</button>
                </div>
            );
        };

        const saveToLog = (entry) => {
            const existing = JSON.parse(localStorage.getItem('logs') || '[]');
            existing.push(entry);
            localStorage.setItem('logs', JSON.stringify(existing));
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('timer');
            return (
                <div className="flex flex-col h-screen max-w-md mx-auto bg-slate-950 shadow-2xl border-x border-slate-900">
                    <div className="p-4 border-b border-slate-800 flex items-center justify-between bg-slate-900">
                        <h1 className="font-bold text-lg tracking-tight text-blue-400">MIND<span className="text-white">CTRL</span></h1>
                        <div className="text-xs text-slate-500 font-mono">v1.2</div>
                    </div>
                    <div className="flex-1 overflow-hidden relative">
                        <div className={activeTab === 'timer' ? 'h-full' : 'hidden'}>
                            <ActivityTimer />
                        </div>
                        {activeTab === 'impulse' && <ImpulseControl />}
                        {activeTab === 'log' && <BehaviorLogger />}
                    </div>
                    <div className="h-16 bg-slate-900 border-t border-slate-800 flex justify-around items-center">
                        <NavButton active={activeTab === 'timer'} onClick={() => setActiveTab('timer')} icon={<IconTimer />} label="Fokus" />
                        <NavButton active={activeTab === 'impulse'} onClick={() => setActiveTab('impulse')} icon={<IconZap />} label="Impuls" />
                        <NavButton active={activeTab === 'log'} onClick={() => setActiveTab('log')} icon={<IconList />} label="Logg" />
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>